---
import {
  ArrowRight,
  MailIcon,
  Asterisk,
  AsteriskIcon,
  AsteriskSquare,
  ChevronDown,
  HelpCircle,
  MessageCircle,
  MessageSquare,
  Package,
  Package2,
  Phone,
  User,
} from "@lucide/astro";
---

<section id="cta" class="py-16 md:py-24 lg:py-32 relative overflow-hidden">
  <!-- Patrón de fondo -->
  <div class="absolute inset-0 bg-background"></div>

  <!-- Contenido principal -->
  <div class="relative z-10 container mx-auto px-4 md:px-6">
    <div class="flex flex-col items-center text-center mb-12">
      <!-- Ícono de Miranti -->
      <img
        src="/miranti/icon-black.svg"
        alt="Miranti"
        class="h-16 md:h-24 mb-6"
      />

      <!-- Encabezado con palabras destacadas -->
      <h2
        class="text-4xl md:text-5xl lg:text-6xl font-serif font-bold text-primary mb-6 max-w-2xl"
      >
        <span class="text-secondary-dark">Únete</span> a la comunidad de
        <span class="text-secondary-dark">artesanos digitales</span> más grande del
        <span class="text-secondary-dark">Perú</span>
      </h2>

      <!-- Línea decorativa -->
      <div class="w-24 h-1 bg-secondary-dark rounded-full mb-8"></div>
    </div>

    <!-- Descripción introductoria -->
    <div class="max-w-4xl mx-auto mb-16 text-center">
      <p class="text-lg md:text-xl text-primary/80">
        Con Miranti, crear tu catálogo digital toma solo minutos, no necesitas
        conocimientos técnicos y te conectarás con clientes de todo el Perú y el
        mundo. ¡El primer paso hacia tu éxito digital está a solo un clic de
        distancia!
      </p>
    </div>

    <!-- Formulario de contacto -->
    <form
      id="artesanos-form"
      action="https://hook.us1.make.com/6vrnnlwsfohcp4ln8dt1nt5ne9ocigzp"
      method="POST"
      class="max-w-lg mx-auto mb-16 bg-white rounded-2xl border border-white/20 shadow-xl p-8 space-y-8"
    >
      <!-- Campo Email -->
      <fieldset class="space-y-2">
        <legend class="sr-only">Correo Electrónico</legend>

        <label
          for="email"
          class="flex items-center gap-2 text-primary"
          id="email-label"
        >
          <MailIcon
            size={16}
            stroke-width={2}
            class="text-primary"
            aria-hidden="true"
          />
          <span
            class="flex items-center gap-1"
            title="Ingresa tu correo electrónico para que podamos contactarte"
          >
            Correo electrónico
            <AsteriskIcon
              size={16}
              stroke-width={2}
              class="text-red-500"
              aria-hidden="true"
            />
          </span>
        </label>

        <input
          type="email"
          id="email"
          name="email"
          required
          title="Ingresa un correo electrónico válido"
          pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"
          inputmode="email"
          placeholder="Ingresa tu correo electrónico"
          aria-labelledby="email-label"
          aria-required="true"
          oninvalid="this.setCustomValidity('Por favor, ingresa un correo electrónico válido')"
          oninput="this.setCustomValidity('')"
          autocomplete="email"
          minlength="5"
          maxlength="70"
          class="w-full px-4 py-3 bg-background shadow-lg rounded-2xl text-primary placeholder:text-primary/50"
        />
      </fieldset>

      <!-- Campo Nombre -->
      <fieldset class="space-y-2">
        <legend class="sr-only">Información Personal</legend>

        <label
          for="nombre"
          class="flex items-center gap-2 text-primary"
          id="nombre-label"
        >
          <User
            size={16}
            stroke-width={2}
            class="text-primary"
            aria-hidden="true"
          />
          <span
            class="flex items-center gap-1"
            title="Ingresa tu nombre completo para que podamos contactarte"
          >
            Nombre completo
            <AsteriskIcon
              size={16}
              stroke-width={2}
              class="text-red-500"
              aria-hidden="true"
            />
          </span>
        </label>

        <input
          type="text"
          id="nombre"
          name="nombre"
          required
          title="Ingresa tu nombre completo usando solo letras y espacios"
          minlength="3"
          maxlength="50"
          pattern="^[A-Za-záéíóúüñÁÉÍÓÚÜÑ']+( [A-Za-záéíóúüñÁÉÍÓÚÜÑ']+)*$"
          inputmode="text"
          placeholder="María Huamán"
          aria-labelledby="nombre-label"
          aria-required="true"
          oninvalid="this.setCustomValidity('Por favor, ingresa tu nombre completo usando solo letras')"
          oninput="this.setCustomValidity('')"
          autocomplete="name"
          class="w-full px-4 py-3 bg-background shadow-lg rounded-2xl text-primary placeholder:text-primary/50"
        />
      </fieldset>

      <!-- Campo WhatsApp -->
      <fieldset class="space-y-2">
        <legend class="sr-only">WhatsApp</legend>
        <label
          for="whatsapp"
          class="flex items-center gap-2 text-primary"
          id="whatsapp-label"
        >
          <Phone
            size={16}
            stroke-width={2}
            class="text-primary"
            aria-hidden="true"
          />

          <span
            class="flex items-center gap-1"
            title="Ingresa tu número de WhatsApp para que podamos contactarte"
          >
            WhatsApp
            <AsteriskIcon
              size={16}
              stroke-width={2}
              class="text-red-500"
              aria-hidden="true"
            />
          </span>
        </label>

        <div class="relative">
          <span
            class="absolute left-4 top-1/2 -translate-y-1/2 text-primary z-10"
          >
            +51
          </span>
          <input
            type="tel"
            id="whatsapp"
            name="whatsapp"
            required
            placeholder="987654321"
            minlength="9"
            maxlength="9"
            pattern="[0-9]{9}"
            inputmode="numeric"
            title="Ingresa exactamente 9 dígitos sin espacios ni otros caracteres"
            aria-labelledby="whatsapp-label"
            oninvalid="this.setCustomValidity('Por favor, ingresa exactamente 9 dígitos sin espacios ni otros caracteres')"
            oninput="this.setCustomValidity('')"
            aria-required="true"
            autocomplete="tel"
            class="w-full pr-4 pl-12 py-3 bg-background shadow-lg rounded-2xl text-primary placeholder:text-primary/50"
          />
        </div>
      </fieldset>

      <!-- Campo Tipo de Artesanía -->
      <fieldset class="space-y-2">
        <legend class="sr-only">Tipo de artesanía</legend>
        <label
          for="artesania"
          class="flex items-center gap-2 text-primary"
          id="artesania-label"
        >
          <Package2
            size={16}
            stroke-width={2}
            class="text-primary"
            aria-hidden="true"
          />
          <span
            class="flex items-center gap-1"
            title="Selecciona el tipo de artesanía o producto que ofreces"
          >
            Tipo de artesanía o producto
            <AsteriskIcon
              size={16}
              stroke-width={2}
              class="text-red-500"
              aria-hidden="true"
            />
          </span>
        </label>

        <div class="relative">
          <select
            id="artesania"
            name="artesania"
            required
            class="w-full pl-4 pr-12 py-3 bg-background shadow-lg rounded-2xl text-primary appearance-none"
          >
            <option value="" disabled selected>
              Selecciona tu especialidad
            </option>
            <option value="textil">Textilería</option>
            <option value="ceramica">Cerámica</option>
            <option value="joyeria">Joyería / Orfebrería</option>
            <option value="madera">Tallado en madera</option>
            <option value="productos-organicos">Productos orgánicos</option>
            <option value="otros">Otros</option>
          </select>
          <span
            class="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-primary z-10"
          >
            <ChevronDown size={18} stroke-width={2} class="text-primary" />
          </span>
        </div>
      </fieldset>

      <!-- Campo de Mensaje -->
      <fieldset class="space-y-2">
        <legend class="sr-only">Mensaje complementario</legend>
        <label
          for="mensaje"
          class="flex items-center gap-2 text-primary"
          id="mensaje-label"
        >
          <MessageCircle
            size={16}
            stroke-width={2}
            class="text-primary"
            aria-hidden="true"
          />
          <span
            class="flex items-center gap-1"
            title="Escribe un mensaje adicional o pregunta que tengas."
          >
            Mensaje adicional
            <AsteriskIcon
              size={16}
              stroke-width={2}
              class="text-red-500"
              aria-hidden="true"
            />
          </span>
        </label>

        <textarea
          id="mensaje"
          name="mensaje"
          required
          title="Escribe un mensaje adicional o pregunta que tengas"
          minlength="3"
          maxlength="1000"
          inputmode="text"
          placeholder="Escribe aquí tu mensaje. Por ejemplo: Soy un artesano de Arequipa y me gustaría saber más sobre cómo funciona Miranti."
          rows="4"
          aria-labelledby="mensaje-label"
          aria-required="true"
          class="w-full px-4 py-3 bg-background shadow-lg rounded-2xl text-primary placeholder:text-primary/50 resize-none"
        ></textarea>
      </fieldset>

      <!-- Checkbox asistencia personalizada -->
      <fieldset class="flex items-center gap-2">
        <legend class="sr-only">
          Checkbox para la asistencia personalizada
        </legend>
        <input
          type="checkbox"
          name="asistencia-personalizada"
          id="asistencia-personalizada"
          value="sí"
          class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"
        />
        <label
          for="asistencia-personalizada"
          class="flex items-center gap-2 text-primary"
          id="asistencia-personalizada-label"
        >
          <span>Quiero asistencia personalizada</span>
        </label>
      </fieldset>

      <!-- Mensaje de estado (añadido) -->
      <div id="form-status" class="hidden">
        <p class="text-center"></p>
      </div>

      <!-- Botón de envío -->
      <button
        type="submit"
        class="w-full bg-secondary hover:bg-secondary/90 text-primary py-4 px-6 rounded-full shadow-lg border border-white/30 flex items-center justify-center gap-2 cursor-pointer"
      >
        <span> Comenzar ahora </span>
        <ArrowRight size={20} stroke-width={1} class="text-primary" />
      </button>
    </form>
  </div>
</section>

<script>
  // Espera a que el DOM esté completamente cargado
  document.addEventListener("DOMContentLoaded", function () {
    // Obtén referencias a los elementos
    const form = document.getElementById("artesanos-form");
    const formStatus = document.getElementById("form-status");

    // Solo adjunta el listener si el formulario existe
    if (form) {
      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(this as HTMLFormElement);
        const submitButton = this.querySelector('button[type="submit"]');

        // Verifica que existan los elementos necesarios
        if (!submitButton || !formStatus) return;

        // Deshabilitar el botón y mostrar estado de carga
        (submitButton as HTMLButtonElement).disabled = true;
        submitButton.innerHTML = "<span>Enviando...</span>";

        try {
          const response = await fetch((this as HTMLFormElement).action, {
            method: "POST",
            body: formData,
          });

          // Muestra el estado según la respuesta
          formStatus.classList.remove("hidden");
          const statusMessage = formStatus.querySelector("p");

          if (statusMessage) {
            if (response.ok) {
              statusMessage.textContent =
                "¡Gracias! Nos pondremos en contacto contigo pronto.";
              statusMessage.className = "text-green-600 text-center";
            } else {
              statusMessage.textContent =
                "Hubo un problema. Por favor, intenta nuevamente.";
              statusMessage.className = "text-red-600 text-center";
            }
          }
        } catch (error) {
          // Maneja errores de red
          formStatus.classList.remove("hidden");
          const statusMessage = formStatus.querySelector("p");

          if (statusMessage) {
            statusMessage.textContent =
              "Error de conexión. Por favor, verifica tu internet.";
            statusMessage.className = "text-red-600 text-center";
          }
        }

        // Restaurar el botón
        (submitButton as HTMLButtonElement).disabled = false;
        submitButton.innerHTML =
          '<span> Comenzar ahora </span> <ArrowRight size={20} stroke-width={1} class="text-primary" />';
      });
    }
  });
</script>
